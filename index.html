<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EcoRota | Mobilidade Urbana</title>
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3202/3202926.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/imask/6.4.3/imask.min.js"></script>

    <style>
        :root { --primary: #10b981; --dark: #0f172a; --light: #f8fafc; --gray: #64748b; --error: #ef4444; --radius: 12px; --shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--light); overflow: hidden; height: 100vh; width: 100vw; color: var(--dark); }

        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 50; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px; transition: opacity 0.3s ease; }
        .hidden { display: none !important; }
        .w-full { width: 100%; }
        .max-w-md { max-width: 400px; }
        .text-center { text-align: center; }
        
        .brand { font-size: 2rem; font-weight: 800; color: var(--dark); letter-spacing: -1px; margin-bottom: 8px; }
        .brand span { color: var(--primary); }
        .tagline { color: var(--gray); font-size: 0.9rem; margin-bottom: 32px; font-weight: 400; }

        .input-group { position: relative; margin-bottom: 16px; width: 100%; }
        .input-field { width: 100%; padding: 16px; border: 1px solid #cbd5e1; border-radius: var(--radius); font-size: 1rem; transition: 0.2s; outline: none; background: #fff; }
        .input-field:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        .input-label { position: absolute; left: 16px; top: 16px; color: var(--gray); pointer-events: none; transition: 0.2s; font-size: 1rem; background: white; padding: 0 4px; }
        .input-field:focus ~ .input-label, .input-field:not(:placeholder-shown) ~ .input-label { top: -10px; font-size: 0.8rem; color: var(--primary); font-weight: 600; }

        .btn { width: 100%; padding: 16px; border: none; border-radius: var(--radius); font-weight: 600; font-size: 1rem; cursor: pointer; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: var(--shadow); }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--dark); color: white; }
        .btn-eco { background: var(--primary); color: white; }
        .btn-outline { background: transparent; border: 2px solid #e2e8f0; color: var(--gray); box-shadow: none; }
        .btn-link { background: none; color: var(--primary); box-shadow: none; font-size: 0.9rem; margin-top: 10px; }

        /* TERMOS JUR√çDICOS (ATUALIZADO) */
        .legal-box { height: 220px; overflow-y: scroll; background: #f8fafc; padding: 16px; border-radius: var(--radius); font-size: 0.75rem; line-height: 1.6; color: #334155; border: 1px solid #cbd5e1; margin-bottom: 16px; text-align: justify; }
        .legal-box h4 { margin: 10px 0 5px 0; color: var(--dark); font-size: 0.85rem; }
        
        #map { width: 100%; height: 100%; position: absolute; top:0; left:0; z-index: 1; filter: saturate(0.8); }
        
        .ui-float { position: absolute; z-index: 100; }
        .top-left { top: 20px; left: 20px; }
        .top-right { top: 20px; right: 20px; }
        .bottom-center { bottom: 40px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; }

        .icon-btn { width: 48px; height: 48px; border-radius: 50%; background: white; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; color: var(--dark); transition: 0.2s; }
        .sos-btn { background: var(--error); color: white; animation: pulse 2s infinite; font-weight: 700; font-size: 0.8rem; }

        .search-modal { background: white; border-radius: 20px; padding: 24px; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); width: 100%; }
        .provider-profile { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
        .avatar { width: 64px; height: 64px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); }
        .p-info h3 { margin: 0; font-size: 1.1rem; }
        .p-info p { margin: 4px 0 0; font-size: 0.9rem; color: var(--gray); }
        .stars { color: #fbbf24; font-size: 0.9rem; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
    </style>
</head>
<body>

    <div id="screen-auth" class="screen">
        <div class="brand">Eco<span>Rota</span></div>
        <div class="tagline">Mobilidade P2P Sustent√°vel</div>
        
        <div class="w-full max-w-md">
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button class="btn btn-outline" id="tab-user" onclick="switchTab('user')">Usu√°rio</button>
                <button class="btn btn-outline" id="tab-prov" onclick="switchTab('prov')">Prestador</button>
            </div>

            <div id="form-login">
                <div class="input-group">
                    <input type="tel" id="login-phone" class="input-field" placeholder=" ">
                    <label class="input-label">Celular (DDD)</label>
                </div>
                <div class="input-group hidden" id="div-pass">
                    <input type="password" id="login-pass" class="input-field" placeholder=" ">
                    <label class="input-label">Senha de Acesso</label>
                </div>
                
                <button class="btn btn-primary" onclick="processLogin()">ENTRAR</button>
                <button class="btn btn-link" onclick="openRegister()">Criar Nova Conta</button>
            </div>
        </div>
        <p style="position:absolute; bottom:20px; color:#cbd5e1; font-size:0.75rem;">Protegido e Seguro</p>
    </div>

    <div id="screen-register" class="screen hidden">
        <h2 style="margin-top:0;">Termos & Cadastro</h2>
        <p style="color:var(--gray); font-size:0.9rem; margin-bottom:15px;">Leia com aten√ß√£o para continuar.</p>
        
        <div class="w-full max-w-md" style="overflow-y:auto;">
            
            <label style="font-weight:bold; font-size:0.8rem; display:block; margin-bottom:5px;">CONTRATO DE USO E RESPONSABILIDADE</label>
            <div class="legal-box" id="legal-scroll">
                <h4>1. NATUREZA DO SERVI√áO</h4>
                <p>O EcoRota √© uma plataforma tecnol√≥gica de intermedia√ß√£o que conecta usu√°rios e prestadores independentes. A PLATAFORMA N√ÉO √â UMA EMPRESA DE TRANSPORTE, n√£o possui frota pr√≥pria e n√£o emprega motoristas.</p>
                
                <h4>2. ISEN√á√ÉO DE RESPONSABILIDADE (RISCO DO USU√ÅRIO)</h4>
                <p>O USU√ÅRIO e o PRESTADOR reconhecem que o uso do servi√ßo √© de sua inteira responsabilidade e CONTA E RISCO. A EcoRota n√£o se responsabiliza por danos diretos, indiretos, acidentes, roubos, perdas, atrasos ou qualquer preju√≠zo decorrente da transa√ß√£o entre as partes.</p>

                <h4>3. DADOS E PRIVACIDADE (N√ÉO ARMAZENAMENTO)</h4>
                <p>O Usu√°rio est√° ciente de que o aplicativo N√ÉO ARMAZENA DADOS EM SERVIDORES EXTERNOS. Todas as informa√ß√µes de cadastro e localiza√ß√£o residem localmente no dispositivo do usu√°rio ou s√£o transmitidas diretamente via WhatsApp para a conex√£o. A EcoRota n√£o mant√©m hist√≥rico de viagens ou dados financeiros.</p>

                <h4>4. INEXIST√äNCIA DE V√çNCULO TRABALHISTA</h4>
                <p>O Prestador atua como profissional aut√¥nomo, sem qualquer v√≠nculo empregat√≠cio, societ√°rio ou de subordina√ß√£o com a EcoRota. O Prestador tem liberdade total de hor√°rios e aceita√ß√£o de servi√ßos.</p>

                <h4>5. PAGAMENTOS E VALORES</h4>
                <p>A EcoRota N√ÉO PROCESSA PAGAMENTOS. Todos os valores s√£o negociados e pagos diretamente entre Usu√°rio e Prestador (P2P). A plataforma n√£o cobra comiss√µes sobre corridas e n√£o interfere em disputas financeiras.</p>

                <h4>6. SUSTENTABILIDADE E SEGURAN√áA</h4>
                <p>√â estritamente proibido o uso de ve√≠culos a combust√£o. Viola√ß√µes resultar√£o em banimento imediato. O Prestador declara possuir bons antecedentes criminais.</p>

                <br><p style="text-align:center; color:var(--primary); font-weight:bold;">VOC√ä CHEGOU AO FIM DO DOCUMENTO.</p>
            </div>

            <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                <input type="checkbox" id="check-terms" disabled>
                <label for="check-terms" style="font-size:0.85rem; color:var(--dark);">Li, compreendi e aceito integralmente os termos acima.</label>
            </div>

            <hr style="border:0; border-top:1px solid #e2e8f0; margin-bottom:20px;">

            <div class="input-group">
                <input type="text" id="reg-name" class="input-field" placeholder=" ">
                <label class="input-label">Nome Completo (RG)</label>
            </div>
            <div class="input-group">
                <input type="tel" id="reg-phone" class="input-field" placeholder=" ">
                <label class="input-label">WhatsApp V√°lido</label>
            </div>
            
            <div id="prov-fields" class="hidden">
                <div class="input-group">
                    <select id="reg-veh" class="input-field" style="background:white;">
                        <option value="" disabled selected>Tipo de Ve√≠culo</option>
                        <option value="Bike">üö≤ Bicicleta</option>
                        <option value="E-Bike">‚ö° Bike El√©trica</option>
                        <option value="Patinete">üõ¥ Patinete</option>
                        <option value="A P√©">üëü A P√© (Office Boy)</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-eco" id="btn-reg-submit" onclick="submitRegister()" disabled style="opacity:0.5;">CRIAR CONTA</button>
            <button class="btn btn-link" onclick="location.reload()">Cancelar</button>
        </div>
    </div>

    <div id="screen-verify" class="screen hidden">
        <div class="text-center">
            <i class="fas fa-user-lock" style="font-size:3rem; color:var(--primary); margin-bottom:20px;"></i>
            <h3>Aprova√ß√£o de Seguran√ßa</h3>
            <p style="color:var(--gray); margin-bottom:30px;">Seus dados ser√£o analisados pelo Administrador para garantir a seguran√ßa da rede.</p>
            
            <button class="btn btn-outline" onclick="sendToAdmin()">1. ENVIAR PARA APROVA√á√ÉO</button>
            <p style="font-size:0.8rem; margin:15px 0; color:#94a3b8;">Insira a senha recebida no WhatsApp:</p>
            
            <div class="input-group">
                <input type="text" id="verify-pass" class="input-field" placeholder=" " style="text-align:center; letter-spacing:3px; font-weight:bold;">
                <label class="input-label">2. Senha de Ativa√ß√£o</label>
            </div>
            
            <button class="btn btn-primary" onclick="activateAccount()">ATIVAR AGORA</button>
        </div>
    </div>

    <div id="screen-map" class="screen hidden" style="background:transparent; padding:0;">
        <div id="map"></div>

        <div class="ui-float top-left">
            <button class="icon-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
        </div>
        <div class="ui-float top-right">
            <button class="icon-btn sos-btn" onclick="sos()">SOS</button>
        </div>

        <div class="ui-float bottom-center hidden" id="panel-user">
            <div class="search-modal">
                <h3 style="margin-top:0;">Onde vamos impactar?</h3>
                <div class="input-group">
                    <select id="search-cat" class="input-field">
                        <option value="Bike">üö≤ Bike (Encomenda)</option>
                        <option value="E-Bike">‚ö° E-Bike (R√°pido)</option>
                        <option value="A P√©">üëü Office Boy (Curto)</option>
                    </select>
                </div>
                <div class="input-group">
                    <input id="search-desc" class="input-field" placeholder=" " type="text">
                    <label class="input-label">Descreva o servi√ßo</label>
                </div>
                <button class="btn btn-primary" onclick="startSearch()">BUSCAR PRESTADOR</button>
            </div>
        </div>

        <div class="ui-float bottom-center hidden" id="panel-prov">
            <div class="search-modal text-center">
                <div style="background:#dcfce7; color:#166534; padding:8px 16px; border-radius:50px; display:inline-block; font-weight:bold; margin-bottom:15px;">
                    üü¢ ONLINE
                </div>
                <p style="color:var(--gray);">Voc√™ est√° vis√≠vel no mapa.<br>Aguarde chamados.</p>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PHONE = "5532984099000"; 
        let map, userRole = 'user', currentMarker;

        window.onload = () => {
            IMask(document.getElementById('login-phone'), {mask:'(00) 00000-0000'});
            IMask(document.getElementById('reg-phone'), {mask:'(00) 00000-0000'});
            
            // TRAVA DO SCROLL (TERMOS)
            const box = document.getElementById('legal-scroll');
            box.addEventListener('scroll', () => {
                // Libera quando chega perto do fim
                if(box.scrollTop + box.clientHeight >= box.scrollHeight - 20) {
                    document.getElementById('check-terms').disabled = false;
                }
            });
            
            document.getElementById('check-terms').addEventListener('change', (e) => {
                const btn = document.getElementById('btn-reg-submit');
                btn.disabled = !e.target.checked;
                btn.style.opacity = e.target.checked ? 1 : 0.5;
            });

            // Login Persistente
            const saved = localStorage.getItem('ecoSession');
            if(saved) {
                const s = JSON.parse(saved);
                enterApp(s.role, s.name);
            }
        };

        function switchTab(role) {
            userRole = role;
            document.querySelectorAll('#screen-auth .btn-outline').forEach(b => {
                b.style.background = 'transparent'; b.style.color = '#64748b'; b.style.borderColor = '#e2e8f0';
            });
            const activeBtn = document.getElementById(role === 'user' ? 'tab-user' : 'tab-prov');
            activeBtn.style.background = 'var(--dark)'; activeBtn.style.color = 'white'; activeBtn.style.borderColor = 'var(--dark)';
            
            if(role === 'prov') document.getElementById('div-pass').classList.remove('hidden');
            else document.getElementById('div-pass').classList.add('hidden');
        }
        switchTab('user');

        function processLogin() {
            const phone = document.getElementById('login-phone').value;
            if(phone.length < 14) return Swal.fire('Aten√ß√£o', 'Celular inv√°lido.', 'error');

            if(userRole === 'user') {
                enterApp('user', 'Visitante');
            } else {
                const pass = document.getElementById('login-pass').value;
                const storedPass = localStorage.getItem('pass_' + phone.replace(/\D/g,''));
                if(pass && pass === storedPass) enterApp('prov', 'Prestador');
                else Swal.fire('Acesso Negado', 'Senha incorreta ou cadastro inexistente.', 'error');
            }
        }

        function openRegister() {
            document.getElementById('screen-auth').classList.add('hidden');
            document.getElementById('screen-register').classList.remove('hidden');
            if(userRole === 'prov') document.getElementById('prov-fields').classList.remove('hidden');
        }

        function submitRegister() {
            const name = document.getElementById('reg-name').value.trim();
            const phone = document.getElementById('reg-phone').value;
            
            if(name.split(' ').length < 2) return Swal.fire('Nome Incompleto', 'Digite Nome e Sobrenome.', 'warning');
            if(phone.length < 14) return Swal.fire('WhatsApp Inv√°lido', 'Verifique o n√∫mero.', 'warning');

            if(userRole === 'prov') {
                if(!document.getElementById('reg-veh').value) return Swal.fire('Ve√≠culo', 'Selecione uma op√ß√£o.', 'warning');
                document.getElementById('screen-register').classList.add('hidden');
                document.getElementById('screen-verify').classList.remove('hidden');
            } else {
                localStorage.setItem('ecoSession', JSON.stringify({role:'user', name:name}));
                Swal.fire('Cadastro Conclu√≠do', 'Bem-vindo ao EcoRota.', 'success').then(() => enterApp('user', name));
            }
        }

        function sendToAdmin() {
            const name = document.getElementById('reg-name').value;
            const phone = document.getElementById('reg-phone').value;
            const veh = document.getElementById('reg-veh').value;
            const msg = `*CADASTRO PRESTADOR*%0A%0ANome: ${name}%0AZap: ${phone}%0AVe√≠culo: ${veh}%0A%0ASolicito a senha de ativa√ß√£o.`;
            window.open(`https://wa.me/${ADMIN_PHONE}?text=${msg}`, '_blank');
        }

        function activateAccount() {
            const pass = document.getElementById('verify-pass').value;
            const phone = document.getElementById('reg-phone').value.replace(/\D/g,'');
            if(pass.length < 3) return Swal.fire('Erro', 'Senha inv√°lida.', 'error');
            
            localStorage.setItem('pass_' + phone, pass);
            localStorage.setItem('ecoSession', JSON.stringify({role:'prov', name:document.getElementById('reg-name').value}));
            Swal.fire('Ativado!', 'Seu perfil profissional est√° pronto.', 'success').then(() => enterApp('prov', ''));
        }

        function enterApp(role, name) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById('screen-map').classList.remove('hidden');
            initMap();
            if(role === 'user') document.getElementById('panel-user').classList.remove('hidden');
            else document.getElementById('panel-prov').classList.remove('hidden');
        }

        function initMap() {
            if(map) return;
            map = L.map('map', {zoomControl: false}).setView([-21.135, -44.261], 15);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
            
            navigator.geolocation.getCurrentPosition(p => {
                const lat = p.coords.latitude;
                const lng = p.coords.longitude;
                map.setView([lat, lng], 16);
                L.marker([lat, lng], {
                    icon: L.divIcon({className:'', html:`<div style="width:18px;height:18px;background:#0f172a;border:3px solid white;border-radius:50%;box-shadow:0 0 0 5px rgba(0,0,0,0.1);"></div>`})
                }).addTo(map);
            });
        }

        function startSearch() {
            const cat = document.getElementById('search-cat').value;
            const desc = document.getElementById('search-desc').value;
            if(!desc) return Swal.fire('Aten√ß√£o', 'Descreva o servi√ßo.', 'info');

            Swal.fire({
                title: 'Buscando Parceiro...',
                html: 'Localizando o profissional mais pr√≥ximo.',
                timer: 2000,
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading()
            }).then(() => {
                const name = "Marcos Silva";
                const rating = "5.0";
                
                Swal.fire({
                    title: 'Profissional Localizado',
                    html: `
                        <div class="provider-profile" style="justify-content:center; text-align:left;">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" class="avatar">
                            <div class="p-info">
                                <h3>${name}</h3>
                                <p>${cat} ‚Ä¢ <span class="stars">‚òÖ ${rating}</span></p>
                                <p style="font-size:0.8rem; color:#10b981;">‚úÖ Documenta√ß√£o Verificada</p>
                            </div>
                        </div>
                        <div style="background:#f1f5f9; padding:10px; border-radius:8px; font-size:0.9rem;">
                            "Ol√°, estou dispon√≠vel para: <b>${desc}</b>"
                        </div>
                    `,
                    confirmButtonText: 'ACEITAR E CONVERSAR',
                    confirmButtonColor: '#10b981',
                    showCancelButton: true,
                    cancelButtonText: 'Cancelar'
                }).then((r) => {
                    if(r.isConfirmed) showEcoImpact();
                    else if(currentMarker) map.removeLayer(currentMarker);
                });

                const center = map.getCenter();
                const iconUrl = 'https://cdn-icons-png.flaticon.com/512/94/94203.png';
                const customIcon = L.icon({iconUrl: iconUrl, iconSize: [40, 40]});
                if(currentMarker) map.removeLayer(currentMarker);
                currentMarker = L.marker([center.lat + 0.001, center.lng + 0.001], {icon: customIcon}).addTo(map);
            });
        }

        function showEcoImpact() {
            Swal.fire({
                title: 'Impacto Ambiental üåø',
                html: `
                    <h3 style="color:#065f46; margin:0;">-0.5 kg de CO2</h3>
                    <p>Ao optar pelo EcoRota, voc√™ contribuiu para um ar mais limpo.</p>
                    <div style="margin:20px 0;">‚≠ê <b style="color:#fbbf24;">+1 Estrela Verde</b></div>
                `,
                confirmButtonText: '<i class="fab fa-whatsapp"></i> ABRIR WHATSAPP',
                confirmButtonColor: '#25D366',
                allowOutsideClick: false
            }).then(() => {
                window.open(`https://wa.me/5532999999999`, '_blank');
            });
        }

        function logout() { localStorage.removeItem('ecoSession'); location.reload(); }
        function sos() { window.open('tel:190'); }
    </script>
</body>
</html>
