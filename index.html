<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EcoRota</title>
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/94/94203.png">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/imask/6.4.3/imask.min.js"></script>

    <style>
        /* ESTILO GERAL */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { --primary: #047857; --eco: #10b981; --bg: #ecfdf5; --dark: #064e3b; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); overflow: hidden; height: 100vh; width: 100vw; position: fixed; }
        
        /* TELAS */
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; transition: 0.3s; }
        .hidden { display: none !important; }
        
        /* LOGO */
        .logo { font-size: 2.5rem; font-weight: 900; color: var(--dark); margin-bottom: 30px; letter-spacing: -1px; }
        .logo span { color: var(--eco); }

        /* BOT√ïES */
        .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: bold; margin-top: 15px; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-google { background: white; border: 2px solid #e5e7eb; color: #374151; }
        .btn-eco { background: var(--eco); color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        .btn-outline { background: transparent; border: 2px solid var(--eco); color: var(--eco); }
        
        /* INPUTS */
        .inp { width: 100%; padding: 15px; border: 2px solid #e5e7eb; border-radius: 12px; margin-bottom: 10px; font-size: 1rem; outline: none; background: #f9fafb; }
        .inp:focus { border-color: var(--eco); background: white; }

        /* MOSAICO (ESCOLHA DE VE√çCULO) */
        .mosaic { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-bottom: 15px; }
        .mosaic-item { border: 2px solid #e5e7eb; border-radius: 15px; padding: 15px; text-align: center; cursor: pointer; transition: 0.2s; }
        .mosaic-item i { font-size: 2rem; color: #9ca3af; display: block; margin-bottom: 5px; }
        .mosaic-item span { font-size: 0.8rem; font-weight: bold; color: #4b5563; }
        
        .mosaic-item.selected { border-color: var(--eco); background: #d1fae5; }
        .mosaic-item.selected i { color: var(--dark); }

        /* UI DO MAPA */
        #map { width: 100%; height: 100%; position: absolute; top:0; left:0; z-index: 1; }
        
        .float-btn { position: absolute; z-index: 50; width: 45px; height: 45px; border-radius: 50%; background: white; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #333; }
        #btn-exit { top: 20px; left: 20px; color: var(--dark); }
        #btn-sos { top: 20px; right: 20px; background: #ef4444; color: white; animation: pulse 2s infinite; font-weight: bold; font-size: 0.8rem; }
        
        /* RODAP√â INFORMATIVO */
        .footer-info { position: absolute; bottom: 10px; width: 100%; text-align: center; font-size: 0.7rem; color: #6b7280; background: rgba(255,255,255,0.9); padding: 5px; z-index: 200; pointer-events: none; }

        /* BOT√ÉO CENTRAL */
        #action-btn { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); background: var(--dark); color: white; padding: 15px 30px; border-radius: 50px; font-weight: bold; box-shadow: 0 10px 25px rgba(0,0,0,0.3); z-index: 50; border: 2px solid var(--eco); cursor: pointer; display: flex; align-items: center; gap: 10px; white-space: nowrap; }

        /* MODAL DE PERFIL (PRESTADOR ENCONTRADO) */
        .profile-modal { text-align: center; }
        .profile-img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--eco); margin-bottom: 10px; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="screen-login" class="screen">
        <div class="logo">Eco<span>Rota</span></div>
        <div style="width: 100%; max-width: 320px;">
            <button class="btn btn-google" onclick="login()">
                <i class="fab fa-google"></i> Entrar com Google
            </button>
        </div>
        <p style="margin-top:30px; font-size:0.8rem; color:#9ca3af;">Vers√£o Sustent√°vel 1.0</p>
    </div>

    <div id="screen-terms" class="screen hidden">
        <h3 style="color:var(--dark)">Termos de Uso</h3>
        <div style="height: 200px; overflow-y: auto; background: #f9fafb; padding: 15px; border-radius: 10px; border: 1px solid #e5e7eb; font-size: 0.85rem; text-align: justify; margin-bottom: 20px;">
            <p><b>1. A PLATAFORMA:</b> O EcoRota conecta usu√°rios a prestadores de mobilidade sustent√°vel (Bike, E-Bike, A P√©).</p>
            <p><b>2. PAGAMENTOS:</b> O aplicativo <b>N√ÉO</b> processa pagamentos. Toda negocia√ß√£o financeira √© feita diretamente entre as partes.</p>
            <p><b>3. RESPONSABILIDADE:</b> O EcoRota n√£o se responsabiliza pela execu√ß√£o dos servi√ßos. O prestador √© aut√¥nomo.</p>
            <p><b>4. SEGURAN√áA:</b> Ao aceitar, voc√™ concorda em compartilhar sua localiza√ß√£o durante o uso.</p>
        </div>
        <label style="display: flex; align-items: center; gap: 10px; font-size: 0.9rem;">
            <input type="checkbox" id="check-terms" onchange="toggleTermBtn()"> Li e concordo com tudo.
        </label>
        <button id="btn-accept-terms" class="btn btn-eco" onclick="aceitarTermos()" disabled style="opacity: 0.5;">CONTINUAR</button>
    </div>

    <div id="screen-role" class="screen hidden">
        <h3 style="color:var(--dark); margin-bottom: 20px;">Como deseja usar?</h3>
        <div style="width: 100%; max-width: 320px;">
            <button class="btn btn-eco" onclick="irPara('user')">üôã SOU USU√ÅRIO</button>
            <button class="btn btn-outline" onclick="irPara('provider')">üö≤ SOU PRESTADOR</button>
        </div>
        <div class="footer-info" style="position: relative; margin-top: 30px; background: transparent;">
            O App apenas conecta. Negocie valores livremente.
        </div>
    </div>

    <div id="screen-provider-reg" class="screen hidden">
        <h3 style="color:var(--dark); margin-top: 0;">Cadastro Eco</h3>
        <div style="width: 100%; max-width: 320px; overflow-y: auto; max-height: 90vh;">
            
            <p style="font-size:0.9rem; color:#6b7280; text-align:center;">Qual seu meio de transporte?</p>
            <div class="mosaic">
                <div class="mosaic-item" onclick="selVeh(this, 'Bike Comum')"><i class="fas fa-bicycle"></i><span>Bike</span></div>
                <div class="mosaic-item" onclick="selVeh(this, 'Bike El√©trica')"><i class="fas fa-bolt"></i><span>E-Bike</span></div>
                <div class="mosaic-item" onclick="selVeh(this, 'Scooter')"><i class="fas fa-scooter"></i><span>Scooter</span></div>
                <div class="mosaic-item" onclick="selVeh(this, 'Office Boy')"><i class="fas fa-walking"></i><span>A P√©</span></div>
            </div>
            <input type="hidden" id="prov-veh">

            <input id="prov-name" class="inp" placeholder="Nome Completo">
            <input id="prov-zap" class="inp" type="tel" placeholder="WhatsApp (DDD)">
            
            <label style="font-size:0.8rem; display: flex; gap: 10px; margin: 10px 0;">
                <input type="checkbox" id="prov-commit"> Comprometo-me a atuar com seguran√ßa.
            </label>

            <button class="btn btn-eco" onclick="enviarParaAdmin()">
                <i class="fas fa-paper-plane"></i> ENVIAR CADASTRO
            </button>
            <button class="btn btn-outline" onclick="location.reload()">VOLTAR</button>
        </div>
    </div>

    <div id="screen-map" class="screen hidden" style="background: transparent; padding: 0; display: block;">
        <div id="map"></div>
        
        <button id="btn-exit" class="float-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
        <button id="btn-sos" class="float-btn" onclick="sos()">SOS</button>

        <button id="action-btn" onclick="pedirServico()">
            <i class="fas fa-search-location"></i> BUSCAR PRESTADOR
        </button>

        <div class="footer-info">
            <i class="fas fa-info-circle"></i> O EcoRota n√£o recebe valores. Combine direto com o prestador.
        </div>
    </div>

    <script>
        // --- VARI√ÅVEIS ---
        let map;
        let role = '';
        let myMarker;
        const adminEmail = "sdilersilva@gmail.com";

        // --- INICIALIZA√á√ÉO ---
        window.onload = () => {
            IMask(document.getElementById('prov-zap'), {mask:'(00) 00000-0000'});
        };

        // 1. LOGIN
        function login() {
            Swal.fire({
                title: 'Autenticando...',
                timer: 1000,
                didOpen: () => Swal.showLoading()
            }).then(() => {
                trocarTela('screen-login', 'screen-terms');
            });
        }

        // 2. TERMOS
        function toggleTermBtn() {
            const chk = document.getElementById('check-terms');
            const btn = document.getElementById('btn-accept-terms');
            btn.disabled = !chk.checked;
            btn.style.opacity = chk.checked ? 1 : 0.5;
        }

        function aceitarTermos() {
            trocarTela('screen-terms', 'screen-role');
        }

        // 3. ROTEAMENTO
        function irPara(tipo) {
            role = tipo;
            if(tipo === 'user') {
                trocarTela('screen-role', 'screen-map');
                iniciarMapa();
            } else {
                trocarTela('screen-role', 'screen-provider-reg');
            }
        }

        // 4. CADASTRO PRESTADOR
        function selVeh(el, tipo) {
            document.querySelectorAll('.mosaic-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('prov-veh').value = tipo;
        }

        function enviarParaAdmin() {
            const nome = document.getElementById('prov-name').value;
            const zap = document.getElementById('prov-zap').value;
            const veiculo = document.getElementById('prov-veh').value;
            const compromisso = document.getElementById('prov-commit').checked;

            if(!nome || !zap || !veiculo || !compromisso) {
                return Swal.fire('Aten√ß√£o', 'Preencha todos os campos e aceite o compromisso.', 'warning');
            }

            // GERA LINK DE EMAIL REAL
            const assunto = `Cadastro EcoRota: ${nome}`;
            const corpo = `Nome: ${nome}%0AWhatsApp: ${zap}%0AVe√≠culo: ${veiculo}%0A%0ASolicito habilita√ß√£o no app.`;
            const mailtoLink = `mailto:${adminEmail}?subject=${assunto}&body=${corpo}`;

            window.location.href = mailtoLink;

            Swal.fire({
                title: 'Enviado!',
                text: 'Seus dados foram enviados para an√°lise. Aguarde nosso contato.',
                icon: 'success'
            }).then(() => location.reload());
        }

        // 5. MAPA E FLUXO USU√ÅRIO
        function iniciarMapa() {
            if(!map) {
                map = L.map('map', {zoomControl: false}).setView([-21.135, -44.261], 15);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
            }
            setTimeout(() => map.invalidateSize(), 500);

            // Tenta Geolocaliza√ß√£o Real
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    const lat = p.coords.latitude;
                    const lng = p.coords.longitude;
                    
                    // √çcone Usu√°rio
                    const iconUser = L.divIcon({
                        className: 'user-pin',
                        html: '<div style="width:15px;height:15px;background:#047857;border:3px solid white;border-radius:50%;box-shadow:0 0 0 10px rgba(16,185,129,0.3);"></div>'
                    });
                    
                    if(myMarker) map.removeLayer(myMarker);
                    myMarker = L.marker([lat, lng], {icon: iconUser}).addTo(map);
                    map.setView([lat, lng], 17);

                    // Adiciona uns prestadores falsos ao redor para dar vida
                    adicionarFakes(lat, lng);

                }, () => alert('Ative o GPS para melhor precis√£o.'), {enableHighAccuracy: true});
            }
        }

        function adicionarFakes(lat, lng) {
            const iconBike = L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/94/94203.png', iconSize:[30,30]});
            L.marker([lat+0.002, lng+0.002], {icon: iconBike}).addTo(map);
            L.marker([lat-0.002, lng-0.002], {icon: iconBike}).addTo(map);
        }

        // 6. BUSCA E CONFIRMA√á√ÉO (O PULO DO GATO)
        async function pedirServico() {
            // 1. Pergunta o que quer
            const { value: desc } = await Swal.fire({
                title: 'O que voc√™ precisa?',
                input: 'text',
                inputPlaceholder: 'Ex: Levar chave no centro...',
                confirmButtonText: 'BUSCAR',
                confirmButtonColor: '#047857',
                showCancelButton: true
            });

            if(!desc) return;

            // 2. Simula Busca
            Swal.fire({
                title: 'Localizando...',
                text: 'Buscando o Eco-Prestador mais pr√≥ximo',
                timer: 2000,
                didOpen: () => Swal.showLoading()
            }).then(() => {
                // 3. ENCONTROU! Mostra o perfil ANTES de confirmar
                mostrarPerfilPrestador();
            });
        }

        function mostrarPerfilPrestador() {
            Swal.fire({
                html: `
                    <div class="profile-modal">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" class="profile-img">
                        <h3>Jo√£o da Silva</h3>
                        <p style="color:#059669; font-weight:bold;">üö≤ Bicicleta El√©trica</p>
                        <p>‚≠ê 5.0 (54 corridas)</p>
                        <hr>
                        <small style="color:#6b7280">Encontramos este prestador pr√≥ximo a voc√™.</small>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '<i class="fab fa-whatsapp"></i> CHAMAR NO WHATSAPP',
                confirmButtonColor: '#25D366', // Cor do Zap
                cancelButtonText: 'Buscar Outro'
            }).then((res) => {
                if(res.isConfirmed) {
                    // Aqui abriria o link real do zap do motorista
                    window.open('https://wa.me/5532999999999?text=Ol√°,%20vi%20seu%20perfil%20no%20EcoRota%20e%20preciso%20de%20um%20servi√ßo.', '_blank');
                } else if (res.dismiss === Swal.DismissReason.cancel) {
                    Swal.fire('Buscando outro...', '', 'info');
                }
            });
        }

        // UTILS
        function trocarTela(atual, proxima) {
            document.getElementById(atual).classList.add('hidden');
            document.getElementById(proxima).classList.remove('hidden');
        }
        function logout() { location.reload(); }
        function sos() { window.open('tel:190'); }

    </script>
</body>
</html>
