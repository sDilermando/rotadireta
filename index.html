<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Rota Direta Elite</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* --- DESIGN SYSTEM "GLASSMORPHISM" --- */
        :root { 
            --primary: #2563eb; --accent: #10b981; --danger: #ef4444; --warning: #f59e0b; --dark: #0f172a; 
            --glass: rgba(255, 255, 255, 0.95); --glass-border: rgba(255, 255, 255, 0.5);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            margin: 0; padding: 0; width: 100%; height: 100vh; 
            background: #e2e8f0; font-family: 'Inter', sans-serif; 
            overflow: hidden; display: flex; flex-direction: column; 
        }

        /* TELA DE LOADING PREMIUM */
        #loading { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #ffffff; z-index: 99999; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            color: var(--primary); 
        }
        .loader-ring {
            width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;
        }

        /* TELAS (SPLASH & LOGIN) */
        .screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #f8fafc; z-index: 10000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 30px; transition: opacity 0.4s ease;
        }
        .hidden { display: none !important; opacity: 0; pointer-events: none; }

        .logo-box { margin-bottom: 50px; text-align: center; }
        .logo { font-size: 2.5rem; font-weight: 900; color: var(--dark); letter-spacing: -1px; }
        .logo span { color: var(--primary); }
        .tagline { font-size: 0.85rem; color: #64748b; margin-top: 5px; }

        /* BOTÕES MODERNOS */
        .btn-xl { 
            width: 100%; max-width: 320px; padding: 20px; margin-bottom: 15px; 
            border: none; border-radius: 16px; font-size: 1rem; font-weight: 700; 
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; 
            box-shadow: 0 10px 30px -10px rgba(37, 99, 235, 0.3); transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-xl:active { transform: scale(0.98); }
        .b-primary { background: var(--dark); color: white; }
        .b-secondary { background: white; color: var(--dark); border: 2px solid #e2e8f0; }

        /* FORMULÁRIOS FLUTUANTES */
        .modal-card { 
            background: white; padding: 30px; border-radius: 24px; width: 100%; max-width: 360px; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); text-align: center; 
        }
        .inp-field { 
            width: 100%; padding: 16px; margin-bottom: 12px; 
            border: 1px solid #e2e8f0; border-radius: 12px; font-size: 1rem; 
            background: #f8fafc; transition: 0.3s; 
        }
        .inp-field:focus { border-color: var(--primary); background: white; }
        
        .btn-action { 
            width: 100%; padding: 16px; background: var(--primary); color: white; 
            border: none; border-radius: 12px; font-weight: 700; font-size: 1rem; 
            margin-top: 10px; cursor: pointer; 
        }
        .link-text { margin-top: 20px; font-size: 0.85rem; color: #64748b; text-decoration: underline; cursor: pointer; }

        /* APP MAPA */
        #app-ui { display: none; flex: 1; position: relative; z-index: 1; }
        #map { width: 100%; height: 100%; z-index: 1; }

        /* CONTROLES DO MAPA (BOTTOM RIGHT) */
        .map-controls { 
            position: absolute; bottom: 120px; right: 20px; z-index: 2000; 
            display: flex; flex-direction: column; gap: 12px; 
        }
        .ctrl-btn { 
            width: 44px; height: 44px; border-radius: 14px; border: none; 
            background: var(--glass); backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); color: var(--dark); font-size: 1.1rem; 
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .ctrl-btn:active { transform: scale(0.9); }
        .c-danger { color: var(--danger); }

        /* DOCK DO MOTORISTA */
        .driver-hud { 
            position: absolute; bottom: 30px; left: 20px; right: 20px; 
            background: var(--glass); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 15px; border-radius: 20px; z-index: 2000; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); border: 1px solid var(--glass-border);
            display: none; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .online-btn { 
            width: 100%; padding: 16px; border: none; border-radius: 14px; 
            font-weight: 800; font-size: 0.9rem; letter-spacing: 0.5px; text-transform: uppercase; 
            cursor: pointer; transition: 0.3s; display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .st-off { background: #f1f5f9; color: #64748b; }
        .st-on { background: var(--accent); color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }

        /* --- MARCADORES PERSONALIZADOS --- */
        
        /* 1. PASSAGEIRO (EU) - Ponto Pulsante */
        .me-marker { position: relative; display: flex; justify-content: center; align-items: center; }
        .me-dot { 
            width: 18px; height: 18px; background: var(--primary); border: 3px solid white; 
            border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: 2;
        }
        .me-pulse {
            position: absolute; width: 40px; height: 40px; background: rgba(37, 99, 235, 0.3);
            border-radius: 50%; animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite; z-index: 1;
        }
        .me-label {
            position: absolute; top: -28px; background: var(--dark); color: white; 
            font-size: 10px; font-weight: bold; padding: 4px 8px; border-radius: 6px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); white-space: nowrap;
        }
        .me-label::after {
            content:''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%);
            border-width: 4px 4px 0; border-style: solid; border-color: var(--dark) transparent transparent transparent;
        }

        /* 2. CARRO (Delicado 25px) */
        .car-wrap { position: relative; width: 40px; height: 40px; transition: all 0.5s ease; }
        .car-body { 
            width: 100%; height: 100%; 
            background-image: url('https://cdn-icons-png.flaticon.com/512/3202/3202926.png'); 
            background-size: contain; background-repeat: no-repeat; 
            filter: drop-shadow(0 4px 3px rgba(0,0,0,0.3));
        }
        .car-badge {
            position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
            background: var(--accent); color: white; font-size: 9px; font-weight: 800;
            padding: 2px 6px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            white-space: nowrap; transition: 0.3s;
        }

        /* ESTADOS DO CARRO */
        .is-busy .car-body { filter: grayscale(1) opacity(0.6); }
        .is-busy .car-badge { background: var(--warning); color: #333; }
        .is-alert .car-badge { background: var(--danger); animation: shake 0.5s infinite; }

        /* ANIMAÇÕES */
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(-50%); } 25% { transform: translateX(-55%); } 75% { transform: translateX(-45%); } }

    </style>
</head>
<body>

    <div id="loading">
        <div class="loader-ring"></div>
        <div style="font-size:0.9rem; letter-spacing:1px; font-weight:600;">CARREGANDO...</div>
    </div>

    <div id="screen-splash" class="screen">
        <div class="logo-box">
            <div class="logo">ROTA <span>DIRETA</span></div>
            <div class="tagline">Mobilidade Urbana Inteligente</div>
        </div>
        
        <button class="btn-xl b-primary" onclick="checkLogin('driver')">
            <i class="fas fa-car-side"></i> SOU MOTORISTA
        </button>
        <button class="btn-xl b-secondary" onclick="checkLogin('passenger')">
            <i class="fas fa-user"></i> SOU PASSAGEIRO
        </button>

        <div style="margin-top:40px; font-size:0.75rem; color:#94a3b8;">
            Versão 12.0 Elite &bull; Build 2025
        </div>
        <div onclick="resetApp()" style="margin-top:15px; color:#ef4444; font-size:0.7rem; font-weight:600; cursor:pointer; opacity:0.6;">
            RESETAR DADOS / ESQUECI SENHA
        </div>
    </div>

    <div id="screen-login-mot" class="screen hidden" style="background:rgba(15, 23, 42, 0.9);">
        <div class="modal-card">
            <h3 style="margin:0 0 10px 0; color:var(--dark);">Bem-vindo de volta</h3>
            <p id="lbl-driver-name" style="color:#64748b; margin-bottom:20px; font-weight:600;">Motorista</p>
            
            <input type="tel" id="inp-pin" class="inp-field" placeholder="Digite seu PIN" 
                   style="text-align:center; font-size:1.8rem; letter-spacing:8px; font-weight:800;" maxlength="4">
            
            <button class="btn-action" onclick="doLoginDriver()">ENTRAR</button>
            <div class="link-text" onclick="goHome()">Cancelar e Voltar</div>
        </div>
    </div>

    <div id="screen-cad-mot" class="screen hidden">
        <div class="modal-card">
            <h3 style="margin-top:0;">Novo Parceiro</h3>
            <input id="reg-name" class="inp-field" placeholder="Nome Completo">
            <input id="reg-car" class="inp-field" placeholder="Carro (Modelo e Cor)">
            <input id="reg-plate" class="inp-field" placeholder="Placa (ABC-1234)" style="text-transform:uppercase;">
            <input id="reg-phone" class="inp-field" type="tel" placeholder="WhatsApp (DDD+Num)">
            <input id="reg-email" class="inp-field" type="email" placeholder="E-mail (Recuperação)">
            
            <button class="btn-action" onclick="registerDriver()">CADASTRAR GRÁTIS</button>
            <div class="link-text" onclick="goHome()">Cancelar</div>
        </div>
    </div>

    <div id="screen-cad-pas" class="screen hidden">
        <div class="modal-card">
            <h3 style="margin-top:0;">Passageiro</h3>
            <input id="pas-name" class="inp-field" placeholder="Seu Nome">
            <input id="pas-phone" class="inp-field" type="tel" placeholder="Seu WhatsApp">
            
            <button class="btn-action" onclick="registerPassenger()">ACESSAR MAPA</button>
            <div class="link-text" onclick="goHome()">Cancelar</div>
        </div>
    </div>

    <div id="app-ui">
        <div id="map"></div>

        <div class="map-controls">
            <button class="ctrl-btn" onclick="shareApp()"><i class="fas fa-share-alt"></i></button>
            <button class="ctrl-btn" onclick="centerMap()"><i class="fas fa-crosshairs"></i></button>
            <button class="ctrl-btn c-danger" onclick="panicMode()"><i class="fas fa-bell"></i></button>
            <button class="ctrl-btn" onclick="location.reload()" style="color:#64748b;"><i class="fas fa-sign-out-alt"></i></button>
        </div>

        <div class="driver-hud" id="driverHud">
            <button id="btn-status" class="online-btn st-off" onclick="toggleStatus()">
                <i class="fas fa-power-off"></i> <span>FICAR ONLINE</span>
            </button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- 1. CORE SYSTEM ---
        const firebaseConfig = {
            apiKey: "AIzaSyBxbRiYNuGde5nwJIaoeRItWdZGR221cpY",
            authDomain: "rota-direta.firebaseapp.com",
            projectId: "rota-direta",
            storageBucket: "rota-direta.firebasestorage.app",
            messagingSenderId: "468273971962",
            appId: "1:468273971962:web:f536de2e2aa74f84dfff43",
            databaseURL: "https://rota-direta-default-rtdb.firebaseio.com"
        };

        let db, auth, map;
        let currentUser = null, userType = null;
        let isOnline = false, watchId = null;
        let markers = {}; 
        let myLat = -23.55, myLng = -46.63; // Default SP
        let botInterval; // Simulação
        
        // Inicialização Segura
        window.onload = function() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                auth = firebase.auth();
                auth.signInAnonymously().then(() => {
                    setTimeout(() => { document.getElementById('loading').style.display = 'none'; }, 800);
                });
            } catch(e) { alert("Erro de Conexão: " + e.message); }
        };

        // --- 2. NAVEGAÇÃO ---
        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById('app-ui').style.display = 'none';
            
            if(id === 'app-ui') {
                document.getElementById('app-ui').style.display = 'flex';
                setTimeout(() => { map.invalidateSize(); }, 300);
            } else {
                document.getElementById(id).classList.remove('hidden');
            }
        }
        function goHome() { switchScreen('screen-splash'); }

        // --- 3. FLUXO DE USUÁRIOS ---
        function checkLogin(type) {
            userType = type;
            const key = type === 'driver' ? 'rd_driver_v12' : 'rd_pass_v12';
            const saved = localStorage.getItem(key);

            if(saved) {
                const data = JSON.parse(saved);
                if(type === 'driver') {
                    document.getElementById('lbl-driver-name').innerText = data.nome;
                    switchScreen('screen-login-mot');
                } else {
                    enterApp(data);
                }
            } else {
                switchScreen(type === 'driver' ? 'screen-cad-mot' : 'screen-cad-pas');
            }
        }

        // --- 4. AÇÕES MOTORISTA ---
        function registerDriver() {
            const form = {
                uid: auth.currentUser.uid,
                pin: Math.floor(1000 + Math.random() * 9000),
                nome: document.getElementById('reg-name').value,
                carro: document.getElementById('reg-car').value,
                placa: document.getElementById('reg-plate').value.toUpperCase(),
                zap: document.getElementById('reg-phone').value.replace(/\D/g,''),
                email: document.getElementById('reg-email').value,
                type: 'driver'
            };

            if(!form.nome || !form.placa || form.zap.length < 10) return Swal.fire('Atenção', 'Preencha todos os dados corretamente.', 'warning');

            localStorage.setItem('rd_driver_v12', JSON.stringify(form));
            db.ref('drivers/' + form.uid).set(form);
            
            Swal.fire({
                title: 'Cadastro Sucesso!',
                html: `Seu PIN de acesso é: <b style="font-size:2rem; color:#2563eb">${form.pin}</b><br>Não esqueça!`,
                icon: 'success'
            }).then(() => enterApp(form));
        }

        function doLoginDriver() {
            const saved = JSON.parse(localStorage.getItem('rd_driver_v12'));
            const pin = document.getElementById('inp-pin').value;
            if(pin == saved.pin) enterApp(saved);
            else Swal.fire('Erro', 'PIN Incorreto', 'error');
        }

        // --- 5. AÇÕES PASSAGEIRO ---
        function registerPassenger() {
            const form = {
                uid: auth.currentUser.uid,
                nome: document.getElementById('pas-name').value,
                zap: document.getElementById('pas-phone').value.replace(/\D/g,''),
                type: 'passenger'
            };
            if(!form.nome || form.zap.length < 10) return Swal.fire('Atenção', 'Preencha seu nome e WhatsApp.', 'warning');
            
            localStorage.setItem('rd_pass_v12', JSON.stringify(form));
            enterApp(form);
        }

        // --- 6. SISTEMA PRINCIPAL (MAPA) ---
        function enterApp(data) {
            currentUser = data;
            switchScreen('app-ui');
            
            if(userType === 'driver') document.getElementById('driverHud').style.display = 'block';
            
            initMap();
            startSimulation(); // Ativa os bots inteligentes
        }

        function initMap() {
            if(!map) {
                map = L.map('map', { zoomControl: false }).setView([myLat, myLng], 15);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; Rota Direta'
                }).addTo(map);
            }
            centerMap(true);
            listenTraffic();
        }

        function centerMap(force = false) {
            navigator.geolocation.getCurrentPosition(pos => {
                myLat = pos.coords.latitude;
                myLng = pos.coords.longitude;
                if(force) map.setView([myLat, myLng], 17);
                
                // DESENHA O USUÁRIO (EU)
                // Remove anterior
                map.eachLayer(l => { if(l.options.icon && l.options.icon.options.className === 'me-class') map.removeLayer(l); });

                const html = `
                    <div class="me-marker">
                        <div class="me-label">Eu</div>
                        <div class="me-pulse"></div>
                        <div class="me-dot"></div>
                    </div>`;
                
                const icon = L.divIcon({ className: 'me-class', html: html, iconSize: [40,40], iconAnchor: [20,20] });
                L.marker([myLat, myLng], {icon}).addTo(map);

            }, err => console.log(err), { enableHighAccuracy: true });
        }

        // --- 7. LÓGICA DE STATUS (MOTORISTA) ---
        function toggleStatus() {
            const btn = document.getElementById('btn-status');
            
            if(!isOnline) {
                if(!navigator.geolocation) return Swal.fire('GPS', 'Ative a localização!', 'warning');
                
                isOnline = true;
                btn.className = 'online-btn st-on';
                btn.innerHTML = '<i class="fas fa-satellite-dish"></i> VOCÊ ESTÁ VISÍVEL';
                
                watchId = navigator.geolocation.watchPosition(pos => {
                    myLat = pos.coords.latitude;
                    myLng = pos.coords.longitude;
                    
                    // ATUALIZA NO BANCO (AGORA O PRÓPRIO CARRO APARECE)
                    db.ref('online/'+currentUser.uid).set({
                        ...currentUser, lat: myLat, lng: myLng, status: 'livre', last_seen: Date.now()
                    });
                    
                    // Centraliza na primeira vez
                    if(!markers[currentUser.uid]) map.setView([myLat, myLng], 17);

                }, null, { enableHighAccuracy: true });

            } else {
                goOffline();
            }
        }

        function goOffline() {
            isOnline = false;
            const btn = document.getElementById('btn-status');
            btn.className = 'online-btn st-off';
            btn.innerHTML = '<i class="fas fa-power-off"></i> FICAR ONLINE';
            
            if(watchId) navigator.geolocation.clearWatch(watchId);
            db.ref('online/'+currentUser.uid).remove();
        }

        // --- 8. ESCUTA DE TRÁFEGO (RENDERIZAÇÃO) ---
        function listenTraffic() {
            db.ref('online').on('value', snap => {
                const list = snap.val() || {};
                
                // Remove carros que saíram
                for(let uid in markers) { if(!list[uid]) { map.removeLayer(markers[uid]); delete markers[uid]; } }

                for(let uid in list) {
                    const d = list[uid];
                    
                    // Define estilo baseado no status
                    let statusClass = '';
                    let labelText = 'LIVRE';
                    
                    if(d.status === 'ocupado') { statusClass = 'is-busy'; labelText = 'OCUPADO'; }
                    if(d.status === 'alerta') { statusClass = 'is-alert'; labelText = 'ALERTA'; }

                    const html = `
                        <div class="car-wrap ${statusClass}">
                            <div class="car-badge">${labelText}</div>
                            <div class="car-body"></div>
                        </div>`;

                    const icon = L.divIcon({ className: 'car-icon-c', html: html, iconSize: [40,40], iconAnchor:[20,20] });

                    // Atualiza ou Cria Marcador
                    if(markers[uid]) {
                        // Movimento suave (Leaflet já faz interpolação simples ao setar LatLng rapidamente)
                        markers[uid].setLatLng([d.lat, d.lng]).setIcon(icon);
                    } else {
                        const m = L.marker([d.lat, d.lng], {icon}).addTo(map);
                        
                        // CLIQUE NO CARRO (INTERAÇÃO)
                        m.on('click', () => {
                            if(userType === 'passenger') {
                                if(d.status === 'ocupado') return Swal.fire('Ocupado', 'Este motorista está em corrida.', 'info');
                                
                                // JANELA DE CONFIRMAÇÃO ELEGANTE
                                Swal.fire({
                                    title: d.nome,
                                    html: `
                                        <div style="font-size:0.9rem; color:#64748b; margin-bottom:10px;">${d.carro} &bull; ${d.placa}</div>
                                        <div style="background:#f1f5f9; padding:10px; border-radius:10px; font-size:0.8rem;">
                                            Motorista avaliado com 5.0 ⭐
                                        </div>
                                    `,
                                    showCancelButton: true,
                                    confirmButtonText: '<i class="fab fa-whatsapp"></i> CHAMAR AGORA',
                                    confirmButtonColor: '#10b981',
                                    cancelButtonText: 'Voltar',
                                    reverseButtons: true
                                }).then((res) => {
                                    if(res.isConfirmed) {
                                        // Ocupa e Chama
                                        db.ref('online/'+d.uid).update({status: 'ocupado'});
                                        const msg = `Olá, sou ${currentUser.nome}. Vi seu carro (${d.carro}) no Rota Direta e gostaria de uma corrida.`;
                                        window.open(`https://wa.me/55${d.zap}?text=${encodeURIComponent(msg)}`, '_blank');
                                    }
                                });
                            }
                        });
                        markers[uid] = m;
                    }
                }
            });
        }

        // --- 9. MATRIX SIMULATION (BOTS INTELIGENTES) ---
        function startSimulation() {
            // Cria 3 bots ao redor da posição inicial
            const bots = [
                { id: 'b1', nome: 'Teste João', carro: 'Gol Branco', lat: myLat+0.002, lng: myLng+0.002, dir: 1, cycle: 0 },
                { id: 'b2', nome: 'Teste Maria', carro: 'Fiat Mobi', lat: myLat-0.002, lng: myLng-0.002, dir: -1, cycle: 5 },
                { id: 'b3', nome: 'Teste Pedro', carro: 'Onix Prata', lat: myLat+0.001, lng: myLng-0.003, dir: 1, cycle: 10 }
            ];

            if(botInterval) clearInterval(botInterval);
            
            botInterval = setInterval(() => {
                bots.forEach(b => {
                    // Movimento: Anda um pouco na direção
                    b.lat += (0.00008 * b.dir);
                    
                    // Se afastar muito, volta
                    if(Math.abs(b.lat - myLat) > 0.005) b.dir *= -1;

                    // Ciclo de Vida: Livre -> Ocupado -> Livre
                    b.cycle++;
                    let st = 'livre';
                    if(b.cycle > 15 && b.cycle < 25) st = 'ocupado'; // Fica ocupado por 10s
                    if(b.cycle > 25) b.cycle = 0; // Reinicia

                    // Publica no banco (para todos verem)
                    db.ref('online/'+b.id).set({
                        uid: b.id, nome: b.nome, carro: b.carro, placa: 'TEST-000', zap: '00',
                        lat: b.lat, lng: b.lng, status: st
                    });
                });
            }, 1000); // Atualiza a cada 1 segundo (movimento fluido)
        }

        // --- EXTRAS ---
        function panicMode() {
            Swal.fire({
                title: 'ACIONAR PÂNICO?',
                text: "Seu ícone ficará vermelho para todos no mapa.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                confirmButtonText: 'SIM, ACIONAR!'
            }).then((r) => {
                if(r.isConfirmed) db.ref('online/'+currentUser.uid).update({status:'alerta'});
            });
        }

        function shareApp() {
            if(navigator.share) navigator.share({title:'Rota Direta', url:window.location.href});
            else Swal.fire('Link Copiado', window.location.href, 'success');
        }

        function resetApp() {
            Swal.fire({
                title: 'Apagar tudo?',
                text: "Isso removerá sua conta deste celular. Útil se esqueceu o PIN.",
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Sim, Resetar',
                confirmButtonColor: '#d33'
            }).then((r) => {
                if(r.isConfirmed) {
                    localStorage.clear();
                    location.reload();
                }
            });
        }

    </script>
</body>
</html>
