<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rota Direta - Teste Azul</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* FUNDO AZUL PARA CONFIRMAR ATUALIZAÇÃO */
        body { background-color: #e0f7fa; font-family: sans-serif; padding: 20px; text-align: center; }
        .box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        button { padding: 15px 30px; font-size: 1.2rem; background: #000; color: #fff; border: none; border-radius: 8px; cursor: pointer; margin: 10px; }
        #log { text-align: left; background: #333; color: #0f0; padding: 10px; font-family: monospace; height: 200px; overflow-y: scroll; border-radius: 5px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <h1>ROTA DIRETA <br><span style="color:blue">MODO TESTE</span></h1>
    
    <div class="box">
        <p>Se esta tela está azul, o código atualizou!</p>
        <button onclick="tentarMotorista()">SOU MOTORISTA</button>
        <button onclick="tentarPassageiro()">SOU PASSAGEIRO</button>
    </div>

    <h3>Relatório do Sistema:</h3>
    <div id="log">Iniciando diagnóstico...<br></div>

    <script>
        // FUNÇÃO PARA ESCREVER NA TELA PRETA
        function log(texto) {
            const caixa = document.getElementById('log');
            caixa.innerHTML += "> " + texto + "<br>";
            console.log(texto);
        }

        // CAPTURA ERROS DE SINTAXE
        window.onerror = function(msg, url, line) {
            log("ERRO CRÍTICO: " + msg + " (Linha " + line + ")");
            alert("ERRO NO CÓDIGO: " + msg);
        };

        // 1. CONFIGURAÇÃO (SEM A BARRA NO FINAL DA URL)
        const firebaseConfig = {
            apiKey: "AIzaSyBxbRiYNuGde5nwJIaoeRItWdZGR221cpY",
            authDomain: "rota-direta.firebaseapp.com",
            projectId: "rota-direta",
            storageBucket: "rota-direta.firebasestorage.app",
            messagingSenderId: "468273971962",
            appId: "1:468273971962:web:f536de2e2aa74f84dfff43",
            databaseURL: "https://rota-direta-default-rtdb.firebaseio.com"
        };

        let db, auth;

        try {
            log("Iniciando Firebase...");
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            auth = firebase.auth();
            log("Firebase carregado.");
        } catch (e) {
            log("FALHA AO INICIAR FIREBASE: " + e.message);
        }

        // TENTA CONECTAR ASSIM QUE ABRE
        window.onload = function() {
            log("Tentando Login Anônimo...");
            if(!auth) return log("Auth não existe. Erro grave.");

            auth.signInAnonymously()
                .then((user) => {
                    log("LOGIN SUCESSO! ID: " + user.user.uid.slice(0,5));
                    log("Conexão pronta. Pode clicar nos botões.");
                    Swal.fire('Conectado!', 'O sistema está online.', 'success');
                })
                .catch((error) => {
                    log("ERRO DE LOGIN: " + error.message);
                    log("Verifique se ativou 'Anônimo' no Console.");
                    alert("Erro de Login: " + error.message);
                });
        };

        function tentarMotorista() {
            log("Botão Motorista Clicado.");
            if(!auth.currentUser) return alert("Aguarde o Login Automático...");

            const nome = prompt("Digite seu nome:");
            if(!nome) return;

            log("Salvando no Banco de Dados...");
            // TESTE REAL DE GRAVAÇÃO
            db.ref('drivers_data/TESTE_' + Date.now()).set({
                nome: nome,
                teste: 'ok'
            }).then(() => {
                log("GRAVAÇÃO NO BANCO DEU CERTO!");
                alert("SUCESSO! O Banco de Dados está funcionando.");
            }).catch(e => {
                log("ERRO AO GRAVAR: " + e.message);
                alert("FALHA NO BANCO: " + e.message);
            });
        }

        function tentarPassageiro() {
            log("Botão Passageiro Clicado.");
            alert("Botão respondendo ok.");
        }
    </script>
</body>
</html>
